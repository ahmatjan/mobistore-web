"use strict";angular.module("wolaiMobiApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/promotion",{templateUrl:"views/promotion/index.html",controller:"PromotionCtrl"}).when("/promotion/points",{templateUrl:"views/promotion/points.html",controller:"PointsExchangeCtrl"}).when("/promotion/snapup",{templateUrl:"views/promotion/snapup.html",controller:"SnapupCtrl"}).otherwise({redirectTo:"/"})}]);var client=angular.module("wolaiMobiApp");client.factory("Constant",["$location",function(a){var b="http://10.0.1.100:8080/wolai-web/",c=b+"api/web/";return{ApiServer:b,ApiUrl:c}}]),client.factory("Vari",[function(){return{CurrentModule:null}}]);var client=angular.module("wolaiMobiApp");client.factory("Util",["Vari",function(a){return{getScreenSize:function(){if(Var.ScreenSize)return console.log("inited"),a.ScreenSize;var b=document.documentElement.clientHeight,c=document.documentElement.clientWidth;return a.ScreenSize={h:b,w:c},a.ScreenSize}}}]),client.factory("StringUtil",[function(){return{isEmpty:function(a){return null===a||"null"===a||void 0===a||"undefined"===a||""===a?!0:!1},isNotEmpty:function(a){}}}]),client.factory("UrlUtil",[function(){return{getParam:function(a){var b=new RegExp("(^|&|\\?)"+a+"=([^&]*)(&|$)","i"),c=window.location.href.substr(1).match(b);return null!=c?unescape(c[2]):null}}}]),angular.module("wolaiMobiApp").controller("MainCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("wolaiMobiApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("wolaiMobiApp").controller("PromotionCtrl",["$rootScope","$scope","$location","$http","Constant","UrlUtil",function(a,b,c,d,e,f){a.loadData=function(){a.token=f.getParam("token"),a.promotionId=f.getParam("promotionId"),d({method:"POST",url:e.ApiUrl+"promotion/detail",params:{token:a.token},data:{id:a.promotionId}}).success(function(b){console.log(b.data),a.promotion=b.data.promotion,a.rewardPoints=b.data.rewardPoints;var d=b.data.promotion.code;"POINTS_EXCHANGE"==d?c.path("/promotion/points"):"SNAPUP_FREE"==d&&c.path("/promotion/snapup")})},a.promotion||a.loadData()}]),angular.module("wolaiMobiApp").controller("PointsExchangeCtrl",["$rootScope","$scope","$http","Constant","UrlUtil",function(a,b,c,d,e){b.complete=!1,b.initData=function(){b.exchangePlan=a.promotion.exchangePlanList[0],b.faceValue=b.exchangePlan.faceValue,console.log(b.exchangePlan),b.remain=b.exchangePlan.qty,b.price=b.exchangePlan.price,b.exNumber="",b.max=Math.floor(a.rewardPoints/b.price),b.max>b.remain&&(b.max=b.remain)},a.promotion?b.initData():(a.token=e.getParam("token"),a.promotionId=e.getParam("promotionId"),c({method:"POST",url:d.ApiUrl+"promotion/detail",params:{token:a.token},data:{id:a.promotionId}}).success(function(c){console.log(c.data),a.promotion=c.data.promotion,a.rewardPoints=c.data.rewardPoints,b.initData()})),b.change=function(){b.exNumber>b.max},b.submit=function(){return b.exNumber?b.exNumber>b.max?void alert("积分不足！"):void c({method:"POST",url:d.ApiUrl+"promotion/pointsExchange",params:{token:a.token},data:{exchangePlanId:b.exchangePlan.id,exNumber:b.exNumber}}).success(function(c){c.balance&&(b.rewardPoints=c.balance),c.remain&&(b.remain=c.remain),b.max=Math.floor(a.rewardPoints/b.price),b.max>b.remain&&(b.max=b.remain),b.complete=!0}):void alert("请输入兑换数量！")}}]),angular.module("wolaiMobiApp").controller("SnapupCtrl",["$rootScope","$scope","$http","Constant","UrlUtil",function(a,b,c,d,e){b.complete=!1,b.alreadSnapup=!1,b.initData=function(){b.exchangePlan=a.promotion.exchangePlanList[0],b.faceValue=b.exchangePlan.faceValue,b.remain=b.exchangePlan.qty},a.promotion?b.initData():(a.token=e.getParam("token"),a.promotionId=e.getParam("promotionId"),c({method:"POST",url:d.ApiUrl+"promotion/detail",params:{token:a.token},data:{id:a.promotionId}}).success(function(c){console.log(c),a.promotion=c.data.promotion,a.rewardPoints=c.data.rewardPoints,b.initData(),c.code<0&&(b.alreadSnapup=!0)})),b.submit=function(){c({method:"POST",url:d.ApiUrl+"promotion/snapup",params:{token:a.token},data:{exchangePlanId:b.exchangePlan.id}}).success(function(a){return a.code<0?void alert("每人只有"+a.timeLimit+"次领取机会！"):(a.remain&&(b.remain=a.remain),b.complete=!0,void(b.alreadSnapup=!0))})}}]),angular.module("wolaiMobiApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/main.html","<div> </div>"),a.put("views/promotion/index.html","<div> </div>"),a.put("views/promotion/points.html",'<div class="promotion points center height-100"> <ul class="layout"> <li class="top"> <dl> <!-- 				<dt><i>¥</i><span>{{faceValue}}</span>\n					<p>代金券</p>\n				</dt> --> <img src="images/app-icon.28fa5cd4.png"> </dl> <div class="carinfos"> <div ng-hide="!complete"> <p>您已获得{{exNumber}}张{{faceValue}}元代金券</p> <p>赶紧去享用吧！</p> </div> <div ng-hide="complete"> <p>服务超级棒的喔来停车</p> <p>积分兑换<span>{{faceValue}}元代金券</span></p> </div> </div> </li> <li class="middle"> <form> <p class="pt10"><input ng-change="change()" ng-model="exNumber" class="btn btn-phone" placeholder="请输入兑换数量"></p> <p class="pt10"><input ng-click="submit()" class="btn btn-shadow" value="兑换代金券" readonly></p> <p class="pt10">您的积分{{rewardPoints}}</p> <p class="pt10">剩余{{remain}}张，最大兑换数量{{max}}</p> </form> </li> <li class="bottom"> <p class="pt10"> <!-- <a href="https://appsto.re/cn/6kfe7.i" tagert="_blank">下载喔来停车APP</a> --> </p> </li> </ul> </div>'),a.put("views/promotion/snapup.html",'<div class="promotion snapup center height-100"> <ul class="layout"> <li class="top"> <dl> <!-- 				<dt><i>¥</i><span>{{promotion.exchangePlanList[0].faceValue}}</span>\n				<p>代金券</p>\n				</dt> --> <img src="images/app-icon.28fa5cd4.png"> </dl> <div class="carinfos"> <div ng-hide="!complete"> <p>您已获得1张{{faceValue}}元代金券</p> <p>赶紧去享用吧！</p> </div> <div ng-hide="complete"> <p>服务超级棒的喔来停车</p> <p>赶快来领取<span>{{faceValue}}元代金券</span></p> </div> </div> </li> <li class="middle"> <form> <p ng-hide="alreadSnapup" class="pt10"> <input ng-click="submit()" class="btn btn-shadow" value="领取代金券" readonly> </p> <p ng-hide="!alreadSnapup" class="pt10"> <input class="btn btn-shadow" value="代金券已领取" readonly> </p> <p class="pt10">剩余{{remain}}张</p> </form> </li> <li class="bottom"> <p class="pt10"> <!-- <a href="https://appsto.re/cn/6kfe7.i" tagert="_blank">下载喔来停车APP</a> --> </p> </li> </ul> </div>')}]);